{"remainingRequest":"/usr/node/app/node_modules/babel-loader/lib/index.js!/usr/node/app/src/store/modules/permission.js","dependencies":[{"path":"/usr/node/app/src/store/modules/permission.js","mtime":1600792748000},{"path":"/usr/node/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/node/app/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/usr/node/app/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.generaMenu = generaMenu;\nexports.filterAsyncRoutes = filterAsyncRoutes;\nexports.filterAsyncPathRoutes = filterAsyncPathRoutes;\nexports.default = exports.loadView = void 0;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"/usr/node/app/node_modules/@babel/runtime-corejs2/helpers/objectSpread2\"));\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nvar _router = require(\"@/router\");\n\nvar _role = require(\"@/api/system/role\");\n\nvar _layout = _interopRequireDefault(require(\"@/layout\"));\n\n// import sysuserindex from '@/views/sysuser/index'\n\n/**\n * Use meta.role to determine if the current user has permission\n * @param roles\n * @param route\n */\nfunction hasPermission(roles, route) {\n  if (route.meta && route.meta.roles) {\n    return roles.some(function (role) {\n      return route.meta.roles.includes(role);\n    });\n  } else {\n    return true;\n  }\n}\n/**\n * Use names to determine if the current user has permission\n * @param names\n * @param route\n */\n\n\nfunction hasPathPermission(paths, route) {\n  if (route.path) {\n    return paths.some(function (path) {\n      return route.path === path.path;\n    });\n  } else {\n    return true;\n  }\n}\n/**\n  * 后台查询的菜单数据拼装成路由格式的数据\n  * @param routes\n  */\n\n\nfunction generaMenu(routes, data) {\n  data.forEach(function (item) {\n    var menu = {\n      path: item.path,\n      component: item.component === 'Layout' ? _layout.default : loadView(item.component),\n      hidden: item.visible !== '0',\n      children: [],\n      name: item.menuName,\n      meta: {\n        title: item.title,\n        icon: item.icon,\n        noCache: true\n      }\n    };\n\n    if (item.children) {\n      generaMenu(menu.children, item.children);\n    }\n\n    routes.push(menu);\n  });\n}\n\nvar loadView = function loadView(view) {\n  // 路由懒加载\n  return function (resolve) {\n    return require(['@/views' + view], resolve);\n  }; // return () => import(`@/views${view}`)\n};\n/**\n * Filter asynchronous routing tables by recursion\n * @param routes asyncRoutes\n * @param roles\n */\n\n\nexports.loadView = loadView;\n\nfunction filterAsyncRoutes(routes, roles) {\n  var res = [];\n  routes.forEach(function (route) {\n    var tmp = (0, _objectSpread2.default)({}, route);\n\n    if (hasPermission(roles, tmp)) {\n      if (tmp.children) {\n        tmp.children = filterAsyncRoutes(tmp.children, roles);\n      }\n\n      res.push(tmp);\n    }\n  });\n  return res;\n}\n/**\n * Filter asynchronous routing tables by recursion\n * @param routes asyncRoutes\n * @param components\n */\n\n\nfunction filterAsyncPathRoutes(routes, paths) {\n  var res = [];\n  routes.forEach(function (route) {\n    var tmp = (0, _objectSpread2.default)({}, route);\n\n    if (hasPathPermission(paths, tmp)) {\n      if (tmp.children) {\n        tmp.children = filterAsyncPathRoutes(tmp.children, paths);\n      }\n\n      res.push(tmp);\n    }\n  });\n  return res;\n}\n\nvar state = {\n  routes: [],\n  addRoutes: []\n};\nvar mutations = {\n  SET_ROUTES: function SET_ROUTES(state, routes) {\n    state.addRoutes = routes;\n    state.routes = _router.constantRoutes.concat(routes);\n  }\n};\nvar actions = {\n  generateRoutes: function generateRoutes(_ref, roles) {\n    var _this = this;\n\n    var commit = _ref.commit;\n    return new Promise(function (resolve) {\n      var loadMenuData = [];\n      (0, _role.getRoutes)().then(function (response) {\n        // console.log(JSON.stringify(response))\n        var data = response;\n\n        if (response.code !== 200) {\n          _this.$message({\n            message: '菜单数据加载异常',\n            type: 0\n          });\n        } else {\n          data = response.data;\n          Object.assign(loadMenuData, data);\n          generaMenu(_router.asyncRoutes, loadMenuData);\n\n          _router.asyncRoutes.push({\n            path: '*',\n            redirect: '/404',\n            hidden: true\n          });\n\n          commit('SET_ROUTES', _router.asyncRoutes);\n          resolve(_router.asyncRoutes);\n        }\n      }).catch(function (error) {\n        console.log(error);\n      });\n    });\n  }\n};\nvar _default = {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};\nexports.default = _default;",null]}